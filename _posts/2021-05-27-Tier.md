---
layout: post
title:  3-Tier Infrastructure
date:   2021-05-24 18:05:55 +0300
image:  pexels-godisable-jacob-1154764.jpg
tags:   Jekyll
---


## 1. 3-Tier Infrastructure 개념 

가장 일반적인 인프라 패턴 중 하나는 3 계층 인프라입니다. 
이 패턴은 인프라를 3 개의 개별 레이어 (공용 레이어 1 개와 비공개 레이어 2 개)로 나눕니다. 
아이디어는 공개 레이어가 비공개 레이어에 대한 방패 역할을한다는 것입니다. 
공용 레이어의 모든 항목은 공개적으로 액세스 할 수 있지만 개인 레이어의 항목은 네트워크 내부에서만 액세스 할 수 있습니다.
네트워크를 3 개의 개별 레이어로 나누는 것 외에도 일종의 고 가용성을 구현하려고합니다. 
AWS를 사용하면 여러 가용 영역에 애플리케이션을 배포하여 고 가용성을 달성 할 수 있습니다. 
각 가용 영역은 서로 다른 지리적 위치에있는 물리적 데이터 센터입니다.

네트워크를 3 개의 가용 영역으로 분할하였고 이것은 고가용 성과 중복성을 제공합니다. 
어떤 이유로 가용 영역 중 하나를 사용할 수없는 경우 트래픽이 다른 두 가용 영역으로 이동하므로 애플리케이션에 영향을주지 않습니다.

네트워크를 3 개의 계층과 3 개의 가용 영역으로 분할하기 위해 다음 서브넷을 만들었습니다.
<br>
(아래 이미지 1 참조)

1. 퍼블릭 레이어 : 이 레이어는 3 개의 퍼블릭 서브넷으로 구성됩니다. 각 가용 영역에 하나씩.
2. 애플리케이션 계층 : 이 계층은 3 개의 프라이빗 서브넷으로 구성됩니다. 각 가용 영역에 하나씩.
3. 데이터베이스 계층 : 이 계층은 3 개의 프라이빗 서브넷으로 구성됩니다. 각 가용 영역에 하나씩.
 


![3-Tier Infrastructure](/images/1a.png) 

## 2. 퍼블릭 서브넷과 프라이빗 서브넷의 차이점


서브넷을 "공개"또는 "개인"으로 만드는 주요 기능은 해당 서브넷의 인스턴스가 인터넷에 액세스하는 방법입니다. 퍼블릭 서브넷은 인스턴스가 인터넷 게이트웨이를 통해 인터넷에 액세스 할 수 있도록 허용하는 서브넷입니다. 반면에 프라이빗 서브넷은 해당 인스턴스가 NAT (네트워크 주소 변환 서버) 또는 Amazon의 관리 형 NAT 서비스 (NAT 게이트웨이)를 통해 인터넷에 액세스 할 수 있도록합니다. AWS에서 관리하고 필요에 따라 확장되므로 Amazon의 NAT 게이트웨이를 사용하기로 선택했습니다.
서브넷이 인터넷 게이트웨이 또는 NAT 게이트웨이를 통해 인터넷에 액세스 할 수 있도록하려면 트래픽을 올바른 게이트웨이로 전달하는 방식으로 서브넷의 라우팅 테이블이 설정되어 있는지 확인해야합니다. 이 예에서는 다음 라우팅 테이블을 설정했습니다.

퍼블릭 서브넷
10.0.0.0/24-> 로컬
0.0.0.0/0-> internet-gateway-id

프라이빗 서브넷
10.0.0.0/24-> 로컬
0.0.0.0/0-> NAT-gateway-id

아래 이미지 2 는 퍼블릭 및 프라이빗 서브넷 모두에 대한 라우팅 테이블을 보여줍니다.

![3-Tier Infrastructure](/imges/2a.png)

각 레이어에는 무엇이 들어가나요?

퍼블릭 레이어
퍼블릭 (최상위) 레이어는 인터넷 연결 Elastic Load Balancer (ELB)와 Bastion 호스트를 호스팅합니다.
ELB는 애플리케이션의 진입 점이며 트래픽을 애플리케이션 서버로 보냅니다.
ELB는 3 개의 가용 영역 모두에서 사용할 수 있어야합니다. 이렇게하면 전체 가용 영역에 문제가 발생하는 경우 고 가용성 및 중복성이 허용됩니다. 다이어그램에는 ELB의 인스턴스가 하나만 표시되며 AWS 콘솔에는 인스턴스가 하나만 표시됩니다. 그러나이면에서 AWS는 해당로드 밸런서 뒤에 EC2 인스턴스가있는 가용 영역에 따라 ELB의 여러 인스턴스를 프로비저닝합니다.
Bastion 호스트 (Jump 호스트라고도 함)는 SSH를 통해 애플리케이션 서버 (또는 프라이빗 서브넷의 다른 서버)에 연결할 수있는 서버입니다.

응용 프로그램 계층
두 번째 계층은 응용 프로그램 계층으로, 여기에 응용 프로그램 서버가 있습니다. 우리의 경우 애플리케이션 서버를 AutoScale Group으로 래핑했습니다. 이를 통해 더 많은 서버가 필요한 경우 애플리케이션을 확장하거나 가용성 영역 중 하나가 서비스가 중단 된 경우 복구 할 수 있습니다. 전체 가용 영역이 서비스되지 않는 경우로드 밸런서는이를 알만큼 똑똑하며 다른 가용 영역에서 확장됩니다.

데이터베이스 계층
세 번째 및 마지막 계층은 데이터베이스 계층입니다. 데이터베이스가있는 곳입니다. 이러한 데이터베이스에 액세스하는 유일한 방법은 애플리케이션 계층에서 데이터베이스에 연결하는 것입니다.
우리의 경우 Amazon에서 제공하는 관리 형 데이터베이스 서비스 인 Amazon의 RDS (Relational Database Service)를 사용하기로 결정했습니다. RDS 사용의 한 가지 장점은 별도의 가용 영역에 장애 조치 데이터베이스 인스턴스를 가질 수 있다는 것입니다. 
또한 하나 이상의 읽기 전용 RDS 인스턴스를 사용하여 기본 데이터베이스의 일부로드를 처리 할 수도 있습니다.
![3-Tier Infrastructure](/images/3a.png)